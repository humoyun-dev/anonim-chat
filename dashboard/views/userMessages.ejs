<%- include("partials/layout-top", { title: "User " + userId + " Conversation", active: "users" }) %>

<div class="container-fluid">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h4 m-0">User <%= userId %> Conversation</h1>
    <div class="d-flex gap-2">
      <a class="btn btn-sm btn-outline-light" href="/user/<%= userId %>/detail">Back</a>
      <a class="btn btn-sm btn-outline-light" href="/users">All Users</a>
    </div>
  </div>

  <div class="card border-0" style="background: rgba(15,23,42,0.35); border: 1px solid rgba(255,255,255,0.08) !important;">
    <div style="padding: 14px; display: flex; flex-direction: column; gap: 10px; max-height: 70vh; overflow: auto;">
      <% if (messages.length === 0) { %>
      <div class="text-center text-muted py-4">No messages in this conversation.</div>
      <% } %>
      <% messages.forEach(message => { %>
        <% const isLeft = message.sender === userId; %>
        <div class="msg-row <%= isLeft ? 'left' : 'right' %>">
          <div class="msg-bubble">
            <div class="msg-text"><%= (message.text && message.text.trim()) ? message.text : ("[" + (message.kind || "media") + "]") %></div>
            <div class="msg-meta">
              <span class="msg-sender"><%= message.sender %></span>
              <span class="msg-time"><%= message.timestamp ? new Date(message.timestamp).toLocaleString() : '' %></span>
            </div>
          </div>
        </div>
      <% }); %>
    </div>
  </div>
</div>

<%- include("partials/layout-bottom") %>
