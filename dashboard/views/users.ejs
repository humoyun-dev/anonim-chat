<%- include("partials/layout-top", { title, active }) %>

<div class="container-fluid">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h4 m-0">Users</h1>
    <a class="btn btn-sm btn-outline-light" href="/chat">Open Chat</a>
  </div>

  <form class="row g-2 mb-3" method="GET" action="/users">
    <div class="col-md-10">
      <input
        type="text"
        class="form-control"
        name="search"
        placeholder="Search users by name or username"
        value="<%= search %>"
      />
    </div>
    <div class="col-md-2">
      <button class="btn btn-primary w-100" type="submit">Search</button>
    </div>
  </form>

  <div class="card border-0" style="background: rgba(15,23,42,0.55); border: 1px solid rgba(255,255,255,0.08) !important;">
    <div class="table-responsive">
      <table class="table table-dark table-hover align-middle mb-0">
        <thead>
          <tr>
            <th>User ID</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Username</th>
            <th style="width: 220px;">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% users.forEach((user) => { %>
          <tr>
            <td><%= user.userId %></td>
            <td><%= user.firstName || "" %></td>
            <td><%= user.lastName || "" %></td>
            <td><%= user.username ? ("@" + user.username) : "" %></td>
            <td>
              <a href="/user/<%= user.userId %>/detail" class="btn btn-sm btn-outline-light"
                >Conversations</a
              >
              <form
                action="/user/<%= user.userId %>/delete"
                method="POST"
                style="display: inline-block"
                onsubmit="return confirm('Are you sure?');"
              >
                <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
                <button class="btn btn-sm btn-outline-danger" type="submit">
                  Delete
                </button>
              </form>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<%- include("partials/layout-bottom") %>
